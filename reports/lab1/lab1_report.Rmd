---
title: "Лабораторная №1"
author: "Веденеева Екатерина"
date: "31-10-2022"
output: html_document
---

## Задание 1

Считаем данные из файла и посмотрим на типы столбцов полученной таблицы.

```{r}
e1 <- read.csv('../../data/lab1_e1.csv')
e1
sapply(e1, typeof)
```

Функция, удаляющая ненужные пробелы и приводящая числовые значения к числовому типу:

```{r}
fix_data <- function(df) {
  # для каждого столбца таблицы
  for (i in seq(ncol(df))) {
    # к каждому элементу сначала применяем функцию, которая удалит все пробелы, затем пытаемся привести его к числовому типу
    col_num <- suppressWarnings(sapply(gsub(" ", "", df[[i]]), as.numeric))
    # проверяем, не появились ли в столбце NA, свидетельствующие о том, что элемент не может быть приведен к нужному типу
    is_not_num = sapply(col_num, is.na)
    # если таких элементов нет - заменяем колонку матрицы на полученную 
    if (length(is_not_num[is_not_num==T]) == 0) {
      df[[i]] <- col_num
    }
  }
  # возвращаем измененную таблицу
  return (df)
}
```

Применим функцию к нашим данным и посмотрим на результат ее работы.

```{r}
e1 <- fix_data(e1)
e1
sapply(e1, typeof)
```

Видим, что ожидаемый результат получен.


## Задание 2
Загрузим данные из файла, и посмотрим на то, в каком формате они хранятся.

```{r}
load(file='../../data/lab1_e2.Rdata')
str(all_data)
```

Функция, преобразующая данные к единому датафрейму со средней температурой пациентов, посетивших каждый из приемов, и их ID:

```{r}
get_id <- function(data) {
  # переименуем столбцы temp датафреймов, чтобы не получить столбцы с одинаковыми названиями в объединенной таблице
  for (i in seq(length(data))) {
    names(data[[i]])[names(data[[i]])=="temp"] <- paste("temp_day_", i, sep = "")
  }
  # объединим все датафреймы в один на основе столбца "id"
  # при значении аргумента all равном False, merge выполняет inner join, оставляя только те строки, которые присутствуют во всех датафреймах
   merged <- Reduce(function(df1, df2) merge(df1, df2,  by="id", all=F), data)
  # создаем новый датафрейм, содержащий столбец ID и среднее значение температуры по каждому пациенту из объединенной таблицы
  without_passes <- data.frame("id"=merged$id, "mean_temp"=rowMeans(merged[-1]))
  # возвращаем итоговый датафрейм
  return (without_passes)
}
```

Применим функцию к нашим данным и посмотрим на результат ее работы.

```{r}
data <- get_id(all_data)
data
```

Видим, что ожидаемый результат получен.
